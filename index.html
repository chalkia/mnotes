<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mnotes</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div id="qrModal" class="qr-modal">
    <div class="qr-content">
        <h3>Scan Song QR</h3>
        <div id="qr-reader"></div>
        <button class="qr-close-btn" onclick="closeQR()">Κλείσιμο</button>
    </div>
</div>

<div id="shareModal" class="qr-modal">
    <div class="qr-content">
        <h3>Share Song</h3>
        <div id="qrcode" style="margin:15px auto; padding:10px; background:white;"></div>
        <button onclick="downloadSingleSong()" class="action-btn" style="background:#2980b9;">💾 Download .mnote</button>
        <button onclick="closeShare()" class="qr-close-btn">Κλείσιμο</button>
    </div>
</div>

<div class="app-layout">
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Library</h3>
            <button onclick="toggleSidebar()" class="close-menu-btn">✕</button>
        </div>
        <span id="songCount" style="font-size:12px; color:#666; margin-bottom:10px; display:block;">0 songs</span>
        
        <div class="playlist-filter">
            <label>Λίστα:</label>
            <select id="playlistSelect" onchange="filterPlaylist()">
                <option value="ALL">📂 Όλα τα τραγούδια</option>
            </select>
        </div>

        <div id="playlistContainer" class="playlist">
            <div class="empty-msg">Κενή Βιβλιοθήκη</div>
        </div>
        
        <div class="sidebar-actions">
            <button onclick="clearLibrary()" class="danger-btn">🗑️ Clear All</button>
            <button onclick="exportJSON()">💾 Export Library</button>
            <button onclick="shareCurrentSong()" style="background:#f39c12; color:white;">📤 Share Song</button>
            <button onclick="startQR()" style="background:#8e44ad; color:white;">📷 Scan QR Import</button>
            <label class="file-btn">
               📂 Import File <input type="file" onchange="importJSON(this)" accept=".json, .mnote" style="display:none;">
            </label>
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <h1 class="logo">mnotes</h1>
            </div>
            <div class="view-controls">
                <button onclick="toEditor()" id="btnEdit">✏️ Editor</button>
                <button onclick="toViewer()" id="btnPlay" class="action">🎵 Play Mode</button>
            </div>
        </div>

        <div id="editor-view">
            <div class="input-grid">
                <div class="field-group"><label>Τίτλος</label><input type="text" id="inpTitle"></div>
                <div class="field-group small"><label>Κλίμακα</label><input type="text" id="inpKey"></div>
            </div>
            <div class="field-group full"><label>Λίστες (Tags)</label><input type="text" id="inpTags"></div>
            <div class="input-grid">
                <div class="field-group"><label>Intro</label><input type="text" id="inpIntro"></div>
                <div class="field-group"><label>Interlude</label><input type="text" id="inpInter"></div>
            </div>
            <div class="field-group full">
                <label>Κυρίως Τραγούδι</label>
                <div class="hint">Αφήστε κενή γραμμή πριν τους στίχους που δεν έχουν ακόρντα για αυτόματο scroll.</div>
                <textarea id="inpBody"></textarea>
            </div>
            <div class="editor-actions">
                <button onclick="saveSong()" class="save-btn">💾 Αποθήκευση</button>
                <button onclick="deleteCurrentSong()" class="danger-btn" id="btnDelete" style="display:none;">🗑️ Διαγραφή</button>
            </div>
        </div>

        <div id="viewer-view">
            <div id="pinnedContainer" class="pinned-box">
                <div class="song-header">
                    <h2 id="displayTitle"></h2>
                    <div id="displayMeta"></div>
                </div>
                <div id="structureBox" class="structure-box" style="display:none;">
                    <div id="displayIntro"></div>
                    <div id="displayInter"></div>
                </div>
                <div id="outputChords"></div>
                <div class="split-divider" id="splitDivider" style="display:none;"><span>▼ Υπόλοιποι Στίχοι ▼</span></div>
            </div>
            <div id="scrollContainer" class="scroll-box">
                <div id="outputLyrics"></div>
            </div>
        </div>
    </div>
</div>

<div id="transUI" class="trans-ui">
    <div class="nav-row"><button class="nav-btn" onclick="prevSong()">▲</button><span class="nav-label">SONG</span><button class="nav-btn" onclick="nextSong()">▼</button></div>
    <hr style="margin:8px 0; border:0; border-top:1px solid rgba(255,255,255,0.2);">
    <div class="t-row"><span class="t-label">TONE</span><button class="t-btn" onclick="addTrans(1)">+</button><span id="t-val" class="t-val">0</span><button class="t-btn" onclick="addTrans(-1)">-</button></div>
    <div class="t-row" style="margin-top:10px;"><span class="t-label">CAPO</span><button class="t-btn" onclick="addCapo(1)">+</button><span id="c-val" class="t-val">0</span><button class="t-btn" onclick="addCapo(-1)">-</button></div>
    <button class="magic-btn" onclick="findSmartCapo()">AUTO</button>
    <div class="key-display">KEY: <span id="visualKey">-</span></div>
</div>

<script src="script.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>
</body>
</html>
