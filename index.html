<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mnotes</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div id="qrModal" class="qr-modal">
    <div class="qr-content">
        <h3>Scan Song QR</h3>
        <div id="qr-reader"></div>
        <button class="qr-close-btn" onclick="closeQR()">Κλείσιμο</button>
    </div>
</div>

<div class="app-layout">
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Library</h3>
            <button onclick="toggleSidebar()" class="close-menu-btn">✕</button>
        </div>
        <span id="songCount" style="font-size:12px; color:#666; margin-bottom:10px; display:block;">0 songs</span>
        <div class="playlist-filter">
            <label>Λίστα:</label>
            <select id="playlistSelect" onchange="filterPlaylist()">
                <option value="ALL">📂 Όλα τα τραγούδια</option>
            </select>
        </div>
        <div id="playlistContainer" class="playlist"><div class="empty-msg">Κενή Βιβλιοθήκη</div></div>
        <div class="sidebar-actions">
            <button onclick="clearLibrary()" class="danger-btn">🗑️ Clear All</button>
            <button onclick="exportJSON()">💾 Export .mnote</button>
            <button onclick="startQR()" style="background:#8e44ad; color:white;">📷 Scan QR Import</button>
            <label class="file-btn">
               📂 Import File <input type="file" onchange="importJSON(this)" accept=".mnote, .json, application/json" style="display:none;">
            </label>
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <h1 class="logo">mnotes</h1>
            </div>
            <div class="view-controls">
                <button onclick="toEditor()" id="btnEdit">✏️ Edit</button>
                <button onclick="toViewer()" id="btnPlay" class="action">🎵 Play</button>
            </div>
        </div>

        <div id="editor-view">
            <div class="input-grid">
                <div class="field-group"><label>Τίτλος</label><input type="text" id="inpTitle"></div>
                <div class="field-group small"><label>Κλίμακα</label><input type="text" id="inpKey"></div>
            </div>
            <div class="field-group full"><label>Λίστες (Tags)</label><input type="text" id="inpTags"></div>
            <div class="field-group full"><label>Παρατηρήσεις</label><input type="text" id="inpNotes"></div>
            <div class="input-grid">
                <div class="field-group"><label>Intro</label><input type="text" id="inpIntro"></div>
                <div class="field-group"><label>Interlude (Γέφυρα)</label><input type="text" id="inpInter"></div>
            </div>
            <div class="field-group full"><label>Κυρίως Τραγούδι</label><textarea id="inpBody"></textarea></div>
            <div class="editor-actions">
                <button onclick="saveSong()" class="save-btn">💾 Αποθήκευση</button>
                <button onclick="deleteCurrentSong()" class="danger-btn" id="btnDelete" style="display:none;">🗑️ Διαγραφή</button>
            </div>
        </div>

        <div id="viewer-view">
            <div id="pinnedContainer" class="pinned-box">
                <div class="mini-header-row">
                    <h2 id="displayTitle"></h2>
                    <span id="visualKey" class="key-badge">-</span>
                    <button id="btnToggleNotes" class="icon-btn" onclick="toggleNotes()" title="Notes">📝</button>
                </div>
                <div id="pinnedInterlude" class="compact-interlude" style="display:none;"></div>
                <div id="displayNotes" class="notes-box" style="display:none;"></div>
            </div>
            
            <div id="scrollContainer" class="scroll-box">
                <div id="scrollIntro" class="intro-block" style="display:none;"></div>

                <div id="outputContent"></div>
                
                <div class="qr-footer">
                    <hr>
                    <div id="playerQR"></div>
                </div>
                <div style="height: 60px;"></div>
            </div>

            <div id="bottomControlBar" class="bottom-bar">
                <div class="b-group">
                    <button class="b-btn" onclick="prevSong()">⏮</button>
                    <button class="b-btn" onclick="nextSong()">⏭</button>
                </div>
                <div class="b-vline"></div>
                <div class="b-group">
                    <span class="b-label">TONE</span>
                    <button class="b-btn" onclick="addTrans(-1)">-</button>
                    <span id="t-val" class="b-val">0</span>
                    <button class="b-btn" onclick="addTrans(1)">+</button>
                </div>
                <div class="b-vline"></div>
                <div class="b-group">
                    <span class="b-label">CAPO</span>
                    <button class="b-btn" onclick="addCapo(-1)">-</button>
                    <span id="c-val" class="b-val">0</span>
                    <button class="b-btn" onclick="addCapo(1)">+</button>
                </div>
                <div class="b-group" style="margin-left:auto;">
                    <button class="b-btn magic" onclick="findSmartCapo()">AUTO</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/data.js"></script>
<script src="js/logic.js"></script>
<script src="js/storage.js"></script>
<script src="js/ui.js"></script>
<script src="js/app.js"></script>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>

</body>
</html>
