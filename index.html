<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mnotes</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#2c3e50">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div id="qrModal" class="qr-modal">
    <div class="qr-content">
        <h3>Scan Song QR</h3>
        <div id="qr-reader"></div>
        <button class="qr-close-btn" onclick="closeQR()">Κλείσιμο</button>
    </div>
</div>

<div class="app-layout">
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Library</h3>
            <button onclick="toggleSidebar()" class="close-menu-btn">✕</button>
        </div>
        <span id="songCount" style="font-size:12px; color:var(--text-light); margin-bottom:10px; display:block;">0 songs</span>
        <div class="playlist-filter">
            <label>Λίστα:</label>
            <select id="playlistSelect" onchange="filterPlaylist()">
                <option value="ALL">📂 Όλα τα τραγούδια</option>
            </select>
        </div>
        <div id="playlistContainer" class="playlist"><div class="empty-msg">Κενή Βιβλιοθήκη</div></div>
        <div class="sidebar-actions">
            <button onclick="clearLibrary()" class="danger-btn">🗑️ Clear All</button>
            <button onclick="exportJSON()" class="action-btn">💾 Export .mnote</button>
            <button onclick="startQR()" class="qr-btn">📷 Scan QR Import</button>
            <label class="file-btn">
               📂 Import File <input type="file" onchange="importJSON(this)" accept=".mnote, .json, application/json" style="display:none;">
            </label>
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <h1 class="logo">mnotes</h1>
            </div>
            <div class="view-controls">
                <button onclick="toEditor()" id="btnEdit" class="nav-btn">✏️ Edit</button>
                <button onclick="toViewer()" id="btnPlay" class="nav-btn primary">🎵 Play</button>
            </div>
        </div>

        <div id="editor-view">
            <div class="input-grid">
                <div class="field-group"><label class="required-label">Τίτλος</label><input type="text" id="inpTitle"></div>
                <div class="field-group small"><label>Κλίμακα (Key)</label><input type="text" id="inpKey"></div>
            </div>
            
            <div class="live-settings-box">
                <span class="live-label">ΡΥΘΜΙΣΕΙΣ LIVE (Προβολή)</span>
                <div class="input-grid" style="margin-bottom:0;">
                    <div class="field-group">
                        <label>Capo (Προσωρινό)</label>
                        <div class="stepper">
                            <button onclick="adjVal('inpCapo', -1)">-</button>
                            <input type="number" id="inpCapo" value="0" readonly>
                            <button onclick="adjVal('inpCapo', 1)">+</button>
                        </div>
                    </div>
                    <div class="field-group">
                        <label>Transpose (Save=Μόνιμο)</label>
                        <div class="stepper">
                            <button onclick="adjVal('inpTrans', -1)">-</button>
                            <input type="number" id="inpTrans" value="0" readonly>
                            <button onclick="adjVal('inpTrans', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div style="font-size:11px; color:#7f8c8d; margin-top:5px; font-style:italic;">
                    * Το Capo δεν αποθηκεύεται. Αν κάνετε Save με Transpose, αλλάζει μόνιμα ο τόνος του τραγουδιού.
                </div>
            </div>

            <div class="field-group full"><label>Λίστες (Tags)</label><input type="text" id="inpTags"></div>
            <div class="field-group full"><label>Παρατηρήσεις</label><input type="text" id="inpNotes"></div>
            <div class="input-grid">
                <div class="field-group"><label>Intro</label><input type="text" id="inpIntro"></div>
                <div class="field-group"><label>Interlude (Γέφυρα)</label><input type="text" id="inpInter"></div>
            </div>
            <div class="field-group full"><label class="required-label">Κυρίως Τραγούδι</label><textarea id="inpBody"></textarea></div>
            <div class="editor-actions">
                <button onclick="saveSong()" class="save-btn">💾 Αποθήκευση</button>
                <button onclick="deleteCurrentSong()" class="danger-btn" id="btnDelete" style="display:none;">🗑️ Διαγραφή</button>
            </div>
        </div>

        <div id="viewer-view">
            <div id="pinnedContainer" class="pinned-box">
                <div class="mini-header-row">
                    <h2 id="displayTitle"></h2>
                    <span id="visualKey" class="key-badge">-</span>
                    <button id="btnToggleNotes" class="icon-btn" onclick="toggleNotes()" title="Notes">📝</button>
                </div>

                <div id="liveStatusRow" class="status-row" style="display:none;">
                    <span id="badgeCapo" class="status-badge capo">CAPO: 0</span>
                    <span id="badgeTrans" class="status-badge trans">TRANS: 0</span>
                </div>

                <div id="pinnedInterlude" class="compact-interlude" style="display:none;"></div>
                <div id="displayNotes" class="notes-box" style="display:none;"></div>
            </div>
            
            <div id="scrollContainer" class="scroll-box">
                <div id="scrollIntro" class="intro-block" style="display:none;"></div>
                <div id="outputContent"></div>
                
                <div class="qr-footer">
                    <hr>
                    <div class="qr-label">Scan to Share</div>
                    <div id="playerQR"></div>
                </div>
                <div style="height: 40px;"></div>
            </div>
            </div>
    </div>
</div>

<script src="js/data.js"></script>
<script src="js/logic.js"></script>
<script src="js/storage.js"></script>
<script src="js/ui.js"></script>
<script src="js/app.js"></script>

<script>
    // Βοηθητική συνάρτηση για τα κουμπιά +/- στον editor
    function adjVal(id, n) {
        var el = document.getElementById(id);
        var v = parseInt(el.value) || 0;
        el.value = v + n;
        // Ειδοποίηση ότι άλλαξε η τιμή
        el.dispatchEvent(new Event('input'));
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>

</body>
</html>
