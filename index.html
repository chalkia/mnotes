<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>mnotes</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div id="qrModal" class="qr-modal">
    <div class="qr-content">
        <h3>Scan Song QR</h3>
        <div id="qr-reader"></div>
        <button class="qr-close-btn" onclick="closeQR()">Κλείσιμο</button>
    </div>
</div>

<div class="app-layout">
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Library</h3>
            <button onclick="toggleSidebar()" class="close-menu-btn">✕</button>
        </div>
        <span id="songCount" style="font-size:12px; color:#666; margin-bottom:10px; display:block;">0 songs</span>
        
        <div class="playlist-filter">
            <label>Λίστα:</label>
            <select id="playlistSelect" onchange="filterPlaylist()">
                <option value="ALL">📂 Όλα τα τραγούδια</option>
            </select>
        </div>

        <div id="playlistContainer" class="playlist">
            <div class="empty-msg">Κενή Βιβλιοθήκη</div>
        </div>
        
        <div class="sidebar-actions">
            <button onclick="clearLibrary()" class="danger-btn">🗑️ Clear All</button>
            <button onclick="exportJSON()">💾 Export Library</button>
            <button onclick="startQR()" style="background:#8e44ad; color:white;">📷 Scan QR Import</button>
            <label class="file-btn">
               📂 Import File <input type="file" onchange="importJSON(this)" accept=".mnote, .json, application/json" style="display:none;">
            </label>
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div class="left-group">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                
                <div class="nav-controls" id="navControls" style="display:none;">
                    <button class="nav-arrow" onclick="prevSong()">◀</button>
                    <button class="nav-arrow" onclick="nextSong()">▶</button>
                </div>
            </div>

            <div id="headerTitle" class="header-title">mnotes</div>

            <div class="view-controls">
                <button onclick="toggleTools()" id="btnTools" style="display:none;" class="tools-btn">⚙️ Key</button>
                <button onclick="toEditor()" id="btnEdit">✏️ Edit</button>
            </div>
        </div>

        <div id="toolsPanel" class="tools-panel">
            <div class="tool-group">
                <span class="tool-label">TONE</span>
                <button class="tool-btn" onclick="addTrans(-1)">-</button>
                <span id="t-val" class="tool-val">0</span>
                <button class="tool-btn" onclick="addTrans(1)">+</button>
            </div>
            <div class="tool-group">
                <span class="tool-label">CAPO</span>
                <button class="tool-btn" onclick="addCapo(-1)">-</button>
                <span id="c-val" class="tool-val">0</span>
                <button class="tool-btn" onclick="addCapo(1)">+</button>
            </div>
            <button class="magic-btn" onclick="findSmartCapo()">AUTO</button>
            <button class="icon-btn" onclick="toggleNotes()" title="Show Notes" id="btnToggleNotes" style="display:none;">📝 Notes</button>
            <div class="key-display">KEY: <span id="visualKey">-</span></div>
        </div>

        <div id="editor-view">
            <div class="input-grid">
                <div class="field-group"><label>Τίτλος</label><input type="text" id="inpTitle"></div>
                <div class="field-group small"><label>Κλίμακα</label><input type="text" id="inpKey"></div>
            </div>
            <div class="field-group full"><label>Λίστες (Tags)</label><input type="text" id="inpTags"></div>
            <div class="field-group full"><label>Παρατηρήσεις</label><input type="text" id="inpNotes"></div>
            <div class="input-grid">
                <div class="field-group"><label>Intro</label><input type="text" id="inpIntro"></div>
                <div class="field-group"><label>Interlude</label><input type="text" id="inpInter"></div>
            </div>
            <div class="field-group full">
                <label>Κυρίως Τραγούδι</label>
                <textarea id="inpBody"></textarea>
            </div>
            <div class="editor-actions">
                <button onclick="saveSong()" class="save-btn">💾 Αποθήκευση</button>
                <button onclick="deleteCurrentSong()" class="danger-btn" id="btnDelete" style="display:none;">🗑️ Διαγραφή</button>
            </div>
        </div>

        <div id="viewer-view">
            <div id="pinnedContainer" class="pinned-box">
                <div id="displayNotes" class="notes-box" style="display:none;"></div>

                <div id="structureBox" class="structure-box" style="display:none;">
                    <div id="displayIntro"></div>
                    <div id="displayInter"></div>
                </div>
                <div id="outputChords"></div>
                <div class="split-divider" id="splitDivider" style="display:none;"><span>▼ Υπόλοιποι Στίχοι ▼</span></div>
            </div>
            
            <div id="scrollContainer" class="scroll-box">
                <div id="outputLyrics"></div>
                <div class="qr-footer">
                    <hr>
                    <div class="qr-label">Scan to Share</div>
                    <div id="playerQR"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>
</body>
</html>
