<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mnotes</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>

<div id="qrModal" class="qr-modal">
    <div style="background:white; padding:10px; border-radius:8px; width:90%; max-width:400px; text-align:center;">
        <h3>Scan Song QR</h3>
        <div id="qr-reader"></div>
        <div style="margin-top:10px; font-size:12px; color:#666;">Σκάναρε κώδικα JSON</div>
    </div>
    <button class="qr-close-btn" onclick="closeQR()">Κλείσιμο Κάμερας</button>
</div>

<div class="app-layout">
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Library</h3>
            <button onclick="toggleSidebar()" style="background:transparent; border:none; font-size:20px; cursor:pointer;">✕</button>
        </div>
        <span id="songCount" style="font-size:12px; color:#666; margin-bottom:10px; display:block;">0 songs</span>
        
        <div class="playlist-filter">
            <label>Λίστα:</label>
            <select id="playlistSelect" onchange="filterPlaylist()">
                <option value="ALL">📂 Όλα τα τραγούδια</option>
            </select>
        </div>

        <div id="playlistContainer" class="playlist">
            <div class="empty-msg">Η βιβλιοθήκη είναι κενή</div>
        </div>
        
        <div class="sidebar-actions">
            <button onclick="clearLibrary()" class="danger-btn">🗑️ Clear All</button>
            <button onclick="exportJSON()">💾 Export Library</button>
            <button onclick="startQR()" style="background:#8e44ad; color:white;">📷 Scan QR Import</button>
            <label class="file-btn">
               📂 Import File <input type="file" onchange="importJSON(this)" style="display:none;">
            </label>
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <h1 class="logo">mnotes</h1>
            </div>
            
            <div class="view-controls">
                <button onclick="toEditor()" id="btnEdit">✏️ Editor</button>
                <button onclick="toViewer()" id="btnPlay" class="action">🎵 Play Mode</button>
            </div>
        </div>

        <div id="editor-view">
            <div class="input-grid">
                <div class="field-group">
                    <label>Τίτλος</label>
                    <input type="text" id="inpTitle" placeholder="Τίτλος Τραγουδιού">
                </div>
                <div class="field-group small">
                    <label>Κλίμακα</label>
                    <input type="text" id="inpKey" placeholder="π.χ. Am">
                </div>
            </div>

            <div class="field-group full">
                <label>Λίστες (Tags)</label>
                <input type="text" id="inpTags" placeholder="π.χ. Λαϊκά, Έντεχνα">
            </div>

            <div class="input-grid">
                <div class="field-group">
                    <label>Εισαγωγή (Intro)</label>
                    <input type="text" id="inpIntro" placeholder="π.χ. !Am !G | !F !E7">
                </div>
                <div class="field-group">
                    <label>Ενδιάμεσα (Interlude)</label>
                    <input type="text" id="inpInter" placeholder="Ακόρντα γέφυρας...">
                </div>
            </div>

            <div class="field-group full">
                <label>Κυρίως Τραγούδι</label>
                <div class="hint">
                    <strong>ΑΥΤΟΜΑΤΟ SCROLL:</strong> Άσε μια κενή γραμμή. Όταν το πρόγραμμα βρει στροφή χωρίς συγχορδίες (χωρίς !), την βάζει αυτόματα στο κάτω μέρος.
                </div>
                <textarea id="inpBody" placeholder="Γράψε εδώ... !Am Στίχοι..."></textarea>
            </div>

            <div class="editor-actions">
                <button onclick="saveSong()" class="save-btn">💾 Αποθήκευση</button>
                <button onclick="deleteCurrentSong()" class="danger-btn" style="width:auto; display:none;" id="btnDelete">🗑️ Διαγραφή</button>
            </div>
        </div>

        <div id="viewer-view">
            <div id="pinnedContainer" class="pinned-box">
                <div class="song-header">
                    <h2 id="displayTitle"></h2>
                    <div id="displayMeta"></div>
                </div>
                
                <div id="structureBox" class="structure-box" style="display:none;">
                    <div id="displayIntro"></div>
                    <div id="displayInter"></div>
                </div>

                <div id="outputChords"></div>
                
                <div class="split-divider" id="splitDivider" style="display:none;">
                    <span>▼ Υπόλοιποι Στίχοι ▼</span>
                </div>
            </div>

            <div id="scrollContainer" class="scroll-box">
                <div id="outputLyrics"></div>
            </div>
        </div>
    </div>
</div>

<div id="transUI" class="trans-ui">
    <div class="nav-row">
        <button class="nav-btn" onclick="prevSong()">▲</button>
        <span class="nav-label">SONG</span>
        <button class="nav-btn" onclick="nextSong()">▼</button>
    </div>
    
    <hr style="margin:8px 0; border:0; border-top:1px solid rgba(255,255,255,0.2);">
    
    <div class="t-row">
        <span class="t-label">TONE</span> 
        <button class="t-btn" onclick="addTrans(1)">+</button>
        <span id="t-val" class="t-val">0</span> 
        <button class="t-btn" onclick="addTrans(-1)">-</button> 
    </div>
    
    <div class="t-row" style="margin-top:10px;">
        <span class="t-label">CAPO</span> 
        <button class="t-btn" onclick="addCapo(1)">+</button>
        <span id="c-val" class="t-val">0</span> 
        <button class="t-btn" onclick="addCapo(-1)">-</button> 
    </div>
    <button class="magic-btn" onclick="findSmartCapo()">AUTO</button>
    <div class="key-display">KEY: <span id="visualKey">-</span></div>

    <hr style="margin:8px 0; border:0; border-top:1px solid rgba(255,255,255,0.2);">

    <div class="metro-box">
        <div class="metro-header">
            <span class="t-label" style="transform:none; writing-mode:horizontal-tb; font-size:10px;">METRO</span>
            <div id="metroVisual" class="metro-led"></div>
        </div>
        
        <select id="rhythmSelect" onchange="updateRhythm()" class="metro-select">
            </select>

        <div class="metro-controls">
            <button class="t-btn small" onclick="changeBpm(-5)">-</button>
            <span id="bpmDisplay" class="t-val" style="font-size:14px;">100</span>
            <button class="t-btn small" onclick="changeBpm(5)">+</button>
        </div>
        
        <button id="btnMetroToggle" class="magic-btn" onclick="toggleMetronome()" style="background:#e74c3c; color:white; margin-top:5px;">
            START
        </button>
    </div>
</div>

<script src="script.js"></script>
<script>
    // Εγγραφή Service Worker για Offline χρήση
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW Registered'))
                .catch(err => console.log('SW Error:', err));
        });
    }
</script>

</body>
</html>
